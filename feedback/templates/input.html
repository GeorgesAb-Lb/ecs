<!-- feedback input -->

{% load feedback %}
{% url feedback_input type page origin as fb_url %}

<html>

<head>
  <link rel="stylesheet" type="text/css" href="{{ MEDIA_URL }}feedback/css/feedback.css" />
  <title>Feedback Eingabe</title>
</head>

<body>

<span class="fb_title">Feedback: Teilen Sie {{ type|fb_type_your }} {{ type|fb_type }} mit</span>

<form action="{{ fb_url }}" method="post" enctype="multipart/form-data" class="main" id="id_form">

  <div class="fb_new">
    <ol class="fb_types">
  {% for t in types %}
    {% ifequal type t %}
      <li class="fb_type_{{ t }} fb_type_selected">{{ t|fb_type }}</li>
    {% else %}
      <li class="fb_type_{{ t }}"><a href="{% url feedback_input t 1 origin %}">{{ t|fb_type }}</a></li>
    {% endifequal %}
  {% endfor %}
    </ol>
    <ol class="fb_form">
  {% if description_error %}
      <li class="fb_error">Beschreibung fehlt!</li>
  {% endif %}
      <li><textarea id="id_description" cols="30" rows="6" name="description">{{ description }}</textarea></li>
  {% if summary_error %}
      <li class="fb_error">Zusammenfassung fehlt!</li>
  {% endif %}
      <li><input id="id_summary" type="text" size="30" maxlength="80" name="summary" value="{{ summary }}" /></li>
      <li><input id="id_submit" type="submit" value="Abschicken" name="submit" /></li>
    </ol>
  </div>

  <input id="id_fb" type="hidden" name="fb_id" />

  <ol class="fb_old">
    <li class="fb_list_top">{{ type|fb_type_many }} anderer Benutzer</li>

  {% if list %}
    {% for fb in list %}
    <li class="fb_list_item">
      <span class="fb_summary">{{ fb.index }}. {{ fb.summary|truncate:20 }}</span>
    {% ifequal fb.me2 'yours' %}
      <span class="fb_yours">(von Ihnen)</span>
    {% endifequal %}
    {% ifequal fb.me2 'u2' %}
      <span class="fb_u2">(Sie auch!)</span>
    {% endifequal %}
    {% ifequal fb.me2 'me2' %}
      <span class="fb_me2"><a href="#" id="id_{{ fb.id }}">Ich auch!</a></span>
    {% endifequal %}
      <br/>
      <span class="fb_description">{{ fb.description|truncate:28 }}</span>
      <br/>
      <span class="fb_others">{{ fb.count|fb_count_persons }} gefällt {{ type|fb_type_this }}</span>

    </li>
    {% endfor %}
    <li class="fb_list_bottom">
    {% if page|greater:1 %}
      <span class="fb_nav_prev"><a href="{% url feedback_input type page|add:'-1' origin %}"><img src="{{ MEDIA_URL }}feedback/images/arrow_left.png" alt="vorheriger Eintrag" /></a></span>
    {% endif %}
    {% if page|less:pages %}
      <span class="fb_nav_next"><a href="{% url feedback_input type page|add:'1' origin %}"><img src="{{ MEDIA_URL }}feedback/images/arrow_right.png" alt="nächster Eintrag" /></a></span>
    {% endif %}
      <span class="fb_nav_info">Seite {{ page }} von {{ pages }} ({{ items }} {{ type|fb_type_items:items }} insgesamt)</span>
    </li>
  {% else %}
    <li class="fb_nolist">
      {{ type|fb_type_none}} {{ type|fb_type_many }}.
    </li>
  {% endif %}
  </ol>

</form>

<div class="fb_js">
  <script type="text/javascript" src="{{ MEDIA_URL }}js/mootools-1.2.4-core.js"></script>
<!--  <script type="text/javascript" src="{{ MEDIA_URL }}js/mootools-1.2.4.4-more.js"></script> -->
  <script type="text/javascript">
    window.addEvent('domready', function(){
       
      /*
       * pre-input information display 
       */

      var Infohandler = new Class({
        initialize: function(id, valfield, info) {
          this.clicked = false;

          var infohandler = this;
          var field = $(id);

          if (field.get(valfield) == '') {
            field.set(valfield, info);

            field.addEvent('click', function(event) {
              event.stop();
              if (infohandler.clicked) { // already cleaned
                return;
              }
              infohandler.clicked = true;
              field.set(valfield, '');
            });

            $('id_submit').addEvent('click', function(event) {
              if (!infohandler.clicked) {
                field.set(valfield, '');
              }
              // event propagates..
            });
          }
        }
      });

      var description_handler = new Infohandler('id_description', 'text', 'Beschreibung {{ type|fb_type_of_your }}');
      var summary_handler = new Infohandler('id_summary', 'value', 'Zusammenfassung');


      /*
       *  me2
       */

      $(document.body).getElements('.fb_me2').addEvent('click', function(event) {
        var id = event.target.get('id').substr(3);
        $('id_fb').set('value', id);
        $('id_form').submit();
      });


      /*
       *  details view
       */

      $(document.body).getElements('.fb_list_item').addEvent('click', function(event) {
        event.stop();
        alert('Details, Details, Details ..');
      });

    });
  </script>
</div>

</body>

</html>
