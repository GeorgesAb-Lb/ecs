{% extends 'base.html' %}

{% block htmlcss %}
  {{ block.super }}
  <link rel="stylesheet" type="text/css" href="{{ MEDIA_URL }}core/css/core.css" />
  <link rel="stylesheet" type="text/css" href="{{ MEDIA_URL}}MooEditable/Assets/MooEditable/MooEditable.css" />
  <link rel="stylesheet" type="text/css" href="{{ MEDIA_URL}}MooDialog/Source/css/MooDialog.css" media="screen" />
{% endblock %}

{% block account %} 
  <a href=""><img src="{{ MEDIA_URL }}core/images/user.png" alt="user"/></a> 
  {{ user.get_full_name }} | {% comment %} <a href="">Profil</a> | {% endcomment %} <a href="/accounts/logout">Logout</a>
  {% load groupchooser %}
  {% groupchooser %}
  <p>
  {% comment %}
  <a href=""><img src="{{ MEDIA_URL }}core/images/search.png" alt="search"/></a> 
  <a href=""><img src="{{ MEDIA_URL }}core/images/help.png" alt="help"/></a>
  {% endcomment %}
  <a href="" class="feedback_trigger"><img src="{{ MEDIA_URL }}images/feedback.png" alt="feedback"/></a>
  </p> 
{% endblock %}

{% block usertoolbar %} 
{% endblock %}
        
{% block usermenu %}
  <ul>
    <li><a href="{% url ecs.core.views.index %}">Übersicht</a></li>
    <li>
      <span class="togglers">Studien</span>
      <ul class="elements">
	<li><a href="{% url ecs.core.views.submission_form_list %}">Eingereichte und Neue</a></li>
        <li><a href="{% url ecs.core.views.create_submission_form %}">neuer Antrag</a></li>
      </ul>
    </li>
    <li>
      <span class="togglers">Studien Meldungen</span>
      <ul class="elements">
	<li><a href="{% url ecs.core.views.notification_list %}">Offene Meldungen</a></li>
        <li><a href="{% url ecs.core.views.select_notification_creation_type %}">neue Meldung</a></li>
      </ul>
    </li>
    <li>
      <span class="togglers">Sitzungen</span>
      <ul class="elements">
        <li><a href="{% url ecs.core.views.meeting_list %}">Sitzungen</a></li>
        <li><a href="{% url ecs.core.views.create_meeting %}">neue Sitzung</a></li>
      </ul>
    </li>
    <!--<li><a href="#">Konversationen</a></li>
    <li><a href="#">zuletzt bearbeitet</a></li>
    <li><a href="#">vorgemerkte Tätigkeiten</a></li>-->
  </ul>
{% endblock %}

{% block headernav %}
    {% block header_actions %}
    {% endblock %}
{% endblock %}

{% block jsbottom %}
  {{ block.super }}
  <script type="text/javascript" src="{{ MEDIA_URL}}MooEditable/Source/MooEditable/MooEditable.js"></script>
  <script type="text/javascript" src="{{ MEDIA_URL }}/MooDialog/Source/Overlay.js"></script>
  <script type="text/javascript" src="{{ MEDIA_URL }}/MooDialog/Source/MooDialog.js"></script>
  <script type="text/javascript" src="{{ MEDIA_URL }}/MooDialog/Source/MooDialog.Iframe.js"></script>
  <script type="text/javascript">
    window.addEvent('domready', function(){
      var toggles = $$('.togglers');
      var content = $$('.elements');
      if (window.accordionitem === undefined)
         accordionitem = -1
      var AccordionObject = new Accordion(toggles, content, { display: accordionitem });

      var feedback_triggers = $(document.body).getElements('a.feedback_trigger');
      var feedback_handler = function() { 
        var url = '/feedback/input/i/1/' + get_origin() + '/';
        new MooDialog.Iframe(url, {
          title: 'Feedback',
          size: {
          width: 700,
          height: 400
        }});
        return false;
      };
      feedback_triggers.addEvent('click', feedback_handler);
    });

    function get_origin() {
      {% comment %}
      // TODO either inject origin from application page or develop an URL scheme which allows solid inference by algorithm
      //
      // Counter example:
      // When used on the "new submission" page the code turns 
      //
      //   http://ecsdev.ep3.at:8081/core/submission_form/new/6c8a98e534294bdf8ba558a037fcb9f8/
      //
      // into 
      //
      //   http-3A-2F-2Fecsdev.ep3.at-3A8081-2Fcore-2Fsubmission_form-2Fnew-2F6c8a98e534294bdf8ba558a037fcb9f8-2F
      //
      // where the feedback is grouped by this origin string but the id 6c8a98e534294bdf8ba558a037fcb9f8 will
      // prevent usable grouping. => we remove the hex id
      {% endcomment %}
      var re_id_axe = /[0-9a-f]{32}/;
      x = encodeURIComponent(window.location.href).replace(/-/g, "--").replace(/%/g, "-").replace(re_id_axe, 'id');
      return x;
    }

  </script>
{% endblock %}
