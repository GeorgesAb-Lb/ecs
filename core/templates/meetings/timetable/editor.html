{% extends 'core.html' %}
{% load core %}

{% block title %}ECS Elektronische Einreichung{% endblock %}

{% block headertitle %}
    Neues Meeting
{% endblock %}

{% block content %}
    <h2>{{ meeting.start|date:'d.m.Y H:i' }}: {{ meeting.title }}</h2>
    <a href="{% url ecs.core.views.add_timetable_entry meeting_pk=meeting.pk %}">Termin hinzufügen</a> | <a href="">Pause hinzufügen</a>
    <ul id="timetable" style="list-style: none;">
    {% for entry in meeting %}
        <li id="entry_{{ entry.pk }}" style="border: 1px solid #eeeeee; margin: 3px; display: block;background-color:#ffffff">
            <h3 style="font-size:1em">{{ entry.start|date:'H:i' }} - {{ entry.end|date:'H:i' }} Uhr</h3>
            <span class="id">#{{ entry.pk }}</span>
            <a href="{% url ecs.core.views.remove_timetable_entry meeting_pk=meeting.pk,entry_pk=entry.pk %}">remove</a>
            <span>Teilnehmer: 
                {% for user in entry.users.all %}{{ user }}{% if not forloop.last %}, {% endif %}{% endfor %}
            </span>
        </li>
    {% endfor %}
    </ul>
{% endblock %}

{% block jsbottom %}
{{ block.super }}
<script type="text/javascript">
function getSortableIndex(el){
    return $('timetable').getChildren().indexOf(el);
}
window.addEvent('domready', function(){
    var dndInfo = {
        startIndex: null
    };
    new Sortables('timetable', {
        clone: true,
        opacity: 0.5,
        revert: true,
        onStart: function(el, clone){
            clone.setStyle('z-index', 100);
            dndInfo.startIndex = getSortableIndex(clone);
        },
        onSort: function(el){
            //console.log(el.id.substring(6));
        },
        onComplete: function(el){
            var toIndex = getSortableIndex(el);
            var fromIndex = dndInfo.startIndex;
            dndInfo.startIndex = null;
            if(fromIndex != toIndex){
                window.location.href = '{% url ecs.core.views.move_timetable_entry meeting_pk=meeting.pk %}?from_index=' + fromIndex + '&to_index=' + toIndex;
            }
        }
    });
});
</script>
{% endblock %}
