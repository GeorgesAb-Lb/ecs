{% load communication core %}

<div class="message_display">
  <h3>{{ thread.subject }}</h3>
  {% for message in page.object_list %}
  <div class="item {% cycle 'even' 'odd' %}">
    <ol>
      <li><strong>Von:</strong> {{ message|sender_name:request.user  }}</li>
      <li><strong>An:</strong> {{ message|receiver_name:request.user }}</li>
      <li><strong>Datum:</strong> {{ message.timestamp|date:'d.m.Y H:i' }} Uhr</li>
      <li><strong>Betreff:</strong> 
          {% if message.thread.submission %}
              {{ message.thread.submission|ec_number }} -
          {% endif %}
          {{ message.thread.subject }}
      </li>
      <li class="actions">
          {% ifequal message.sender request.user %}
              <a class="open-in-widget" href="{% url ecs.communication.views.bump_message message_pk=message.pk %}?next={{ request.path|urlencode }}" title="Bump"><img src="{{ MEDIA_URL }}/images/core/arrow-circle.png" alt="bump" /></a>
          {% else %}
              <a class="open-in-popup" href="{% url ecs.communication.views.send_message reply_to_pk=message.pk %}" title="Antworten"><img src="{{ MEDIA_URL }}/images/core/mail-reply.png" alt="antworten" /> </a>
              <a class="open-in-popup" href="{% url ecs.communication.views.delegate_thread thread_pk=message.thread.pk %}" title="Delegieren"><img src="{{ MEDIA_URL }}/images/core/mail-forward.png" alt="delegieren" /></a>
          {% endifequal %}
          <a class="close-popup" href="{% url ecs.communication.views.close_thread thread_pk=message.thread.pk %}" title="Erledigt"><img src="{{ MEDIA_URL }}/images/core/tick.png" alt="erledigt" /></a>
      </li>
      <li style="border-top: 1px solid #999999">
          <pre>{{ message.text|safe }}</pre>
      </li>
    </ol>
  </div>
  {% endfor %}
</div>
