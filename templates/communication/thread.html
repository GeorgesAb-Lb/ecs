{% extends "core.html" %}
{% load i18n core userutils %}

{% block menuSelection %}communication{% endblock %}

{% block headertitle %}
    {% if thread.submission %}
        {{ thread.submission|ec_number }} -
    {% endif %}
    {{ thread.subject }}
    ({{ message_list|length }})
{% endblock %}

{% block content %}
<div class="communication_thread">

<a href="{% url ecs.communication.views.threads %}">{% trans "Back to the thread overview" %}</a>

<ul class="thread">
{% for message in message_list %}
    <li class="message">
        <div class="head">
            <span class="sender">{{ message.sender }}</span>
            <span class="preview">{{ message.text|safe|smart_truncate:80 }}</span>
            <span class="time">{{ message.timestamp|date:'d.m.Y H:i' }} Uhr</span>
        </div>
        <pre class="body">{{ message.text|safe }}<pre>
    </li>
{% endfor %}
</ul>

<form class="send" method="post">
    <table>
        {{ form.as_table }}
    </table>
    <input type="submit" value="{% trans "Send" %}">
</form>

<a href="{% url ecs.communication.views.threads %}">{% trans "Back to the thread overview" %}</a>

</div>
{% endblock %}

{% block jsbottom %}
    {{ block.super }}
    <script type="text/javascript">
      window.addEvent('domready', function(){
        var communication_thread = $$('.communication_thread')[0];
        var container = communication_thread.getElement('ul');
        new ecs.communication.Thread(container);

        var messageToolbarItems = [];

        {% if thread.submission %}
            messageToolbarItems.push(ecs.textarea.toolbarItems.annotations("{% trans 'Insert Annotations' %}", '{% url ecs.pdfviewer.views.copy_annotations %}?submission_form_pk={{ thread.submission.current_submission_form.pk }}'));
        {% endif %}

        {% if user|has_flag:'internal' %}
            messageToolbarItems.push(ecs.textarea.toolbarItems.boilerplate("{% trans 'Insert Boilerplate' %}", "{% url ecs.boilerplate.views.select_boilerplate %}"));
        {% endif %}

        var textarea = communication_thread.getElement('textarea[name="text"]');
        new ecs.textarea.TextArea(textarea);
        ecs.textarea.installToolbar(textarea, messageToolbarItems);
      });
    </script>
{% endblock %}

