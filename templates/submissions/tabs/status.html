{% load i18n userutils %}
<table>
    <tr><th>Formulare:</th><td colspan="3">
        <table>
            <tr>
                <th>Version</th>
                <th>Eingereicht von</th>
                <th>Eingereicht am</th>
                <th colspan="2">Versionen</th>
                <th></th>
            </tr>
            {% for sf in submission_forms %}
            <tr class="version">
                <td>{{ forloop.revcounter }}</td>
                <td>{{ sf.presenter }}</td>
                <td>{{ sf.created_at|date:'d.m.Y, H:i' }} Uhr</td>
                <td>
                    {% if sf.previous_form %}
                        <span class="icon_diff"></span><a href="{% url ecs.core.views.diff old_submission_form_pk=sf.previous_form.pk,new_submission_form_pk=sf.pk %}">aktuelle Änderungen</a>
                    {% endif %}
                </td>
                <td>
                    {% if sf != submission_form %}
                        <span class="icon_diff"></span><a href="{% url ecs.core.views.diff old_submission_form_pk=sf.pk,new_submission_form_pk=submission_form.pk %}">Unterschiede zur neuesten Version</a>
                    {% endif %}
                    {% if sf.is_notification_update %}
                        {% with sf.new_for_notification.all.0 as notif %}
                            {% if notif %}
                            <a href="{% url ecs.notifications.views.view_notification notification_pk=notif.pk %}">{{ notif }}</a>
                            {% endif %}
                        {% endwith %}
                    {% endif %}
                </td>
                <td>
                    {% if sf == submission_form %}
                        <a href="{% url ecs.core.views.submission_pdf submission_form_pk=sf.pk %}"><button>{% trans "Download PDF" %}</button></a>
                    {% endif %}
                </td>
            </tr>
            {% endfor %}
        </table>
    </td></tr>
    <tr>
        <th>Eingereicht von:</th>
        <td colspan="3">{{ submission_form.presenter }}</td>
    </tr>
    <tr>
        <th>Sponsor:</th>
        <td colspan="3">{{ submission_form.sponsor }}</td>
    </tr>
    <tr>
        <th>Rechnungsempfänger:</th>
        <td colspan="3">{% if submission_form.invoice %}{{ submission_form.invoice }}{% else %}<em>{% trans "same as sponsor" %}</em>{% endif %}</td>
    </tr>
    <tr>
        <th>Hauptprüfer:</th>
        <td colspan="3">{% if submission_form.primary_investigator %}{{ submission_form.primary_investigator.contact.full_name }} ({{ submission_form.primary_investigator.organisation }}){% else %}<em>{% trans "No Primary Investigator" %}</em>{% endif %}</td>
    </tr>
    <tr>
        <th>Phase:</th>
        <td colspan="3">
            {% if submission_form.submission.is_active %}
                {% trans "Aktiv" %}
            {% else %}
                {% if submission_form.acknowledged %}
                    {% trans "Akzeptiert" %}
                {% else %}
                    {% trans "Neu" %}
                {% endif %}
            {% endif %}
        </td>
    </tr>
    <tr>
        <th>Typ:</th>
        <td colspan="3">
            {{ submission_form.get_submission_type_display }}
            {% if submission_form.amg %}{% trans "AMG" %}(ECT:{{submission_form.eudract_number }}, {{ submission_form.get_submission_type_display }}){% endif %}
            {% if submission_form.mpg %}{% trans "MPG" %}{% endif %}
            {% if submission_form.thesis %}{{ submission_form.get_project_type_education_context_display }}{% endif %}
        </td>
    </tr>
    <tr>
        <th>Monozentrisch:</th>
        <td>{{ submission_form.monocentric|yesno }}</td>
        <th class="small">Multizentrisch:</th>
        <td>{{ submission_form.multicentric|yesno }}</td>
    </tr>
    <tr>
        <th>Ethikkommission:</th>
        <td colspan="3">{{ submission_form.main_ethics_commission|default:'<em>Keine Angabe</em>' }}</td>
    </tr>
    <tr>
        <th>Sitzungen:</th>
        <td colspan="3">
            <ul>
                {% for meeting in submission_form.submission.meetings.all %}
                    <li><a href="{% url ecs.meetings.views.timetable_editor meeting_pk=meeting.pk %}">{{ meeting.start|date:'d.m.Y' }} {{ meeting.title }}</a></li>
                {% endfor %}
            </ul>
            {% if user|has_flag:'executive_board_member' %}
                <a href="{% url ecs.meetings.views.reschedule_submission submission_pk=submission_form.submission.pk %}">{% trans 'Reschedule' %}</a>
            {% endif %}
        </td>
    </tr>
    <tr>
        <th>Voten:</th>
        <td colspan="3">
            <ul>
                {% for vote in submission_form.submission.votes.all %}
                    <li>{{ vote.result_text }}{% if vote.top %} (in der Sitzung am {{ vote.top.meeting.start|date:'d.m.Y' }}){% endif %}</li>
                {% endfor %}
            </ul>
        </td>
    </tr>
    <tr>
        <th>Kategorien:</th>
        <td colspan="3">
            {% for cat in submission_form.submission.medical_categories.all %}
                {{ cat }}{% if not forloop.last %}, {% endif %}
            {% endfor %}
        </td>
    </tr>
    <tr>
        <th>Exedited Review:</th>
        <td colspan="3">{{ submission_form.submission.expedited|yesno }}</td>
    </tr>
</table>

{% if user|has_flag:'internal' %}
<ul>
{% for task in cancelable_tasks %}
    <li>
        {% blocktrans with task.task_type as task_name and task.assigned_to as assigned_to and task.assigned_at|date:'d.m.Y' as assigned_at %}
            {{ task_name }} ({{ assigned_to }}), invited at {{ assigned_at }}
        {% endblocktrans %}
        <a href="{% url ecs.core.views.delete_task submission_form_pk=submission_form.pk task_pk=task.pk %}">{% trans "delete" %}</a>
    </li>
{% empty %}
    <li><i>{% trans "No additional/external review" %}</i></li>
{% endfor %}
</ul>
{% endif %}


<a href="{% url ecs.core.views.export_submission submission_pk=submission_form.submission.pk %}"><button>{% trans "Export" %}</button></a>

