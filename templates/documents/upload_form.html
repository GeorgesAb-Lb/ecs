{% load core i18n userutils %}

<div class="doclist">
{% for doc in documents %}
    {% ifchanged doc.doctype.identifier %}
        <h4>{{ doc.doctype }}</h4>
    {% endifchanged %}

    <div class="list_item">
        {% block actions %}
            {% if doc.doctype.is_downloadable or user|has_flag:'is_internal' %}
                <a href="{% url 'ecs.docstash.views.download_document' docstash_key=request.docstash.key document_pk=doc.pk %}">{% trans "Download" %}</a> |
            {% endif %}
            <a href="{% url 'ecs.docstash.views.view_document' docstash_key=request.docstash.key document_pk=doc.pk %}" target="_blank">{% trans "View" %}</a> |
            <a href="{% block delete_url %}{% endblock %}?document_pk={{ doc.pk }}" class="delete_document">{% trans "Delete" %}</a>
            | <a href="" class="replace_document" data-document-id="{{ doc.pk }}" data-document-type="{{ doc.doctype.pk }}">{% trans "Replace" %}</a>
            <span class="document_display_name" style="display:none;">
                {% if doc.name %}
                {{ doc.name|smart_truncate:100 }}
                {% else %}
                Dateiname: {{ doc.original_file_name|smart_truncate:100 }}
                {% endif %}
                - {{ doc.version|smart_truncate:100 }} vom {{ doc.date|date:'d.m.Y' }}
            </span>
        {% endblock %}
        <span class="doc_name">
            {% if doc.name %}
            {{ doc.name }}
            {% else %}
            Dateiname: {{ doc.original_file_name }}
            {% endif %}
            -  <em>Version {{ doc.version }} vom {{ doc.date|date:'d.m.Y' }}</em>
        </span><br />
    </div>
{% empty %}
    <p>Noch keine Unterlagen</p>
{% endfor %}
</div>

{% block extra_hint %}{% endblock %}
<div class="form form_main document_upload">
    <form action="{{ request.path }}" method="post" enctype="multipart/form-data">
        {% csrf_token %}
        <ol>
            {% for hidden in form.hidden_fields %}
                {{ hidden }}
            {% endfor %}
            {% for field in form %}
                {% if not field.is_hidden %}
                    {% include "forms/field.html" %}
                {% endif %}
            {% endfor %}
            <div class="hint">
                <span class="icon_comment"></span>{% trans "Use the calendar icon to select a date." %}
            </div>
            <li style="display:none;">
                {% trans "Replaces document" %} <span id="replaced_document_name"></span>
                <a href="" class="new_document">{% trans "New Document" %}</a>
            </li>
        </ol>
        <input type="submit" name="upload" value="{% trans 'Upload' %}" />
        <progress></progress>
        <div class="warning">
            <span class="icon_warning"></span>
            {% trans "Please be patient, the file is being uploaded and processed" %}
        </div>
        </div>
    </form>
</div>

<script type="text/javascript"> 
    ecs.setupDocumentUploadForms();
</script>
