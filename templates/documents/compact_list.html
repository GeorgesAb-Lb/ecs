{# context: documents #}
{% load core pdfviewer i18n %}
{% block document_list %}
<div class="doclist">

{% regroup documents|dictsort:"doctype.name" by doctype as doctype_list %}

{% for doctype in doctype_list %}
    <h3>{{ doctype.grouper }}</h3>
    {% for doc in doctype.list %}
        <div>
            {% get_annotations for doc as annotations %}
            <a href="{% url ecs.documents.views.download_document document_pk=doc.pk %}">
                {{ doc.name|smart_truncate:40 }}-{{ doc.version|smart_truncate:40 }} vom {{ doc.date|date:'d.m.Y' }}
                {% if doc.original_file_name %}(Dateiname: {{ doc.original_file_name|smart_truncate:40 }}){% endif %}
            </a>
            {% block actions %}
                <a href="{% url ecs.documents.views.download_document doc.pk %}">{% trans "Download" %}</a>
                | <a href="{% url pdf_show doc.pk %}" target="_blank">{% trans "View" %}</a>
                {% if annotations %}
                    | <a href="{% url ecs.pdfviewer.views.share_annotations doc.pk %}" class="open-in-popup">{% trans "Share Annotations" %}</a>
                {% endif %}
            {% endblock %}
            {% if annotations %}
                <ul>
                {% for annotation in annotations %}
                    <li>
                        <a href="{% url pdf_show doc.pk %}#{{ annotation.page_number }}">
                            Seite {{ annotation.page_number }}, {{ annotation.human_readable_location }}: {{ annotation.text|default:'<em>Kein Text</em>' }}
                        </a>
                    </li>
                {% endfor %}
                </ul>
            {% endif %}
        </div>
    {% endfor %}
{% empty %}
    <p>Noch keine Unterlagen</p>
{% endfor %}

</div>
{% endblock %}

