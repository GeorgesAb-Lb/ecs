{% extends 'core.html' %}
{% load core %}

{% block htmltitle %}ECS Elektronische Einreichung{% endblock %}

{% block headertitle %}
<h1>Sitzungsassistent</h1>
{% endblock %}

{% block menuSelection %}meetings{% endblock %}

{% block content %}
<div id="meeting_assistant">
    <div class="left">
        {% with meeting.open_tops.count as open_top_count %}
            <a href="{% url ecs.core.views.meeting_assistant_clear meeting_pk=meeting.pk %}">Clear</a>
            {% if not meeting.started %}
                | <a href="{% url ecs.core.views.meeting_assistant_start meeting_pk=meeting.pk %}">Start</a>
            {% else %}
                {% if not meeting.ended and open_top_count == 0 %}
                    | <a href="{% url ecs.core.views.meeting_assistant_stop meeting_pk=meeting.pk %}">Stop</a>
                {% endif %}
            {% endif %}
            <div class="info">
                <div>TOPs: {{ meeting|length }}</div>
                <div>Offene TOPs: {{ open_top_count }}</div>
                <div>Offene TOPs mit Votum: {{ meeting.open_tops_with_vote.count }}</div>
                <div>
                    {% if meeting.started %}
                        Beginn: {{ meeting.started|date:'H:i' }} Uhr
                    {% else %}
                        Noch nicht begonnen.
                    {% endif%}
                </div>
                <div>
                    Geplanter Beginn: {{ meeting.start|date:'H:i' }} Uhr
                </div>
                <div>
                    Geplantes Ende: {{ meeting.end|date:'H:i' }} Uhr
                </div>
                {% if meeting.ended %}
                    <div>Ende: {{ meeting.ended|date:'H:i' }} Uhr</div>
                {% endif %}
                <div>
                    Aktuelle Uhrzeit: <span id="clock">{% now "H:i" %}</span> Uhr
                </div>
            </div>
            <div class="navigation">
                {% if meeting.started %}
                    {% block meeting_assistant_navigation %}
                        <form action="{% url ecs.core.views.meeting_assistant_quickjump meeting_pk=meeting.pk %}">
                            <input type="text" name="q"/><input type="submit" value="Suchen" />
                        </form>
                    {% endblock %}
                {% endif %}
            </div>
        {% endwith %}
    </div>
    <div id="meeting_assistant_body">
        {% block meeting_assistant_body %}
        {% endblock %}
    </div>
    <div class="right">
        {% block meeting_assistant_sidebar %}{% endblock %}
    </div>
</div>
{% endblock %}

{% block jsbottom %}
{{ block.super }}
<script type="text/javascript">
    window.addEvent('domready', function(){
        setInterval(function(){
            $('clock').innerHTML = (new Date()).format('%H:%M');
        }, 6000);
    });
</script>
{% endblock %}
