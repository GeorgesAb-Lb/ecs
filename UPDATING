			  UPDATE INSTRUCTIONS

This file contains update instructions which will have to be performed
in addition to the usual steps. In chronological order:

--- Production state Nov. 2015 ---

* 2015-11-26: Full backup required

  Due to heavy refactoring of the document storage, modification and
  retrieval facilities it is of uttermost importance to perform a full
  backup _before_ upgrading production to the newest version.

	$ cp -R ~/ecs-storage-vault ~/ecs-storage-vault.bak
	$ pg_dump -Fc -Ox ecs > ~/`date +F`.pgdump

  Better backup too much, than not enough!

* 2015-11-26: Mediaserver removal

  The mediaserver has been removed. The caching and rendering
  directories can be removed.

	$ rm -rf ~/ecs-rendercache ~/ecs-doccache

* 2015-11-26: Handling of incominng files

  Due to refactoring of the document upload pipeline, the incoming file
  directory is not used anymore.

	$ rm -rf ~/ecs-incoming ~/ecs-temp/incoming-copy

* 2015-11-27: Removal of the genfile directory

  The genfile directory has not been used for quite some time now. The
  related settings in settings.py have been removed.

	$ rm -rf ~/ecs-generated

* 2015-12-10: Storage vault options changed

  The deployment specific django configuration files need to be adapted
  for the changed settings.

  The STORAGE_VAULT and STORAGE_VAULT_OPTIONS have been removed. Use the
  STORAGE_VAULT_DIR option instead to set the working directory of the
  storage valt. e.g.:

	STORAGE_VAULT = 'ecs.documents.storagevault.LocalFileStorageVault'
	STORAGE_VAULT_OPTIONS = {
	    'LocalFileStorageVault.rootdir': '/home/ecs/ecs-storage-vault',
	}

  needs to be replaced with

	STORAGE_VAULT_DIR = '/home/ecs/ecs-storage-vault'

* 2015-12-10: ecs-temp unused

  The ~/ecs-temp directory, the TEMPFILE_DIR setting and the TEMPFILE_DIR_MAXAGE
  setting are not used anymore. The ~/ecs-temp directory can be removed.

	$ rm -rf ~/ecs-temp

* 2015-12-11: pki file layout

  The pki file layout has been changed. The following manual steps have
  to be performed after the upgrade.

	$ mv ~/ecs-ca ~/ecs-ca.bak
	$ mkdir ~/ecs-ca
	$ cp ~/ecs-ca.bak/{ca.cert.pem,crl.pem} ~/ecs-ca/

* 2015-12-13: django-dbtemplates and django-reversion now use south

  The django-dbtemplates and the django-reversion apps have been changed to use
  south for database migrations. For the upgrade to work correctly with the
  existing tables,the first migration of the respective app has to be fake
  applied before running the other migrations.

	$ ./manage.py migrate dbtemplates 0001 --fake
	$ ./manage.py migrate reversion 0001 --fake
	$ ./manage.py migrate

--- Next release ---
